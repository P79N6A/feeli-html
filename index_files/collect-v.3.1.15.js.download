var collect=function(){"use strict";var e=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e};var r=void 0,n=function n(){var t=this;!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,n),this.set=function(e,r){var n=e,o=r;if(null===o)return!1;var i="";if(n.indexOf(".")>-1){var s=n.split(".");i=s[0],n=s[1]}"os_version"===n&&(o=""+o),i?"user"===i||"header"===i?t.envInfo[i][n]=o:"headers"===i?t.envInfo.header.headers[n]=o:t.envInfo.header.headers.custom[n]=o:t.envInfo.user.hasOwnProperty(n)?"user_type"===n?(o=Number(o),t.envInfo.user[n]=Number(o)):"user_id"===n?(t.envInfo.user[n]=String(o),t.envInfo.user.user_unique_id=String(o)):t.envInfo.user[n]=String(o):t.envInfo.header.hasOwnProperty(n)?t.envInfo.header[n]=o:t.envInfo.header.headers.hasOwnProperty(n)?t.envInfo.header.headers[n]=o:t.envInfo.header.headers.custom[n]=o},this.get=function(){var n={user:{},header:{headers:{custom:{}}}},o=t.envInfo,i=o.user,s=Object.keys(i),a=Array.isArray(s),c=0;for(s=a?s:s[Symbol.iterator]();;){var u;if(a){if(c>=s.length)break;u=s[c++]}else{if((c=s.next()).done)break;u=c.value}var f=u;i[f]!==r&&(n.user[f]=i[f])}var l=o.header,d=Object.keys(l),h=Array.isArray(d),p=0;for(d=h?d:d[Symbol.iterator]();;){var v;if(h){if(p>=d.length)break;v=d[p++]}else{if((p=d.next()).done)break;v=p.value}var y=v;l[y]!==r&&"headers"!==y&&(n.header[y]=l[y])}var _=o.header.headers,g=Object.keys(_),w=Array.isArray(g),b=0;for(g=w?g:g[Symbol.iterator]();;){var m;if(w){if(b>=g.length)break;m=g[b++]}else{if((b=g.next()).done)break;m=b.value}var O=m;"custom"!==O&&_[O]!==r&&(n.header.headers[O]=_[O])}var S=o.header.headers.custom,k=Object.keys(S);if(k.length){var E=k,T=Array.isArray(E),q=0;for(E=T?E:E[Symbol.iterator]();;){var x;if(T){if(q>=E.length)break;x=E[q++]}else{if((q=E.next()).done)break;x=q.value}var I=x;n.header.headers.custom[I]=S[I]}}return{user:n.user,header:e({},n.header,{headers:n.header.headers})}},this.envInfo={user:{user_id:r,web_id:r,user_unique_id:r,ssid:r,user_type:r},header:{app_id:r,app_name:r,os_name:r,os_version:r,device_model:r,ab_client:r,ab_version:r,traffic_type:r,utm_source:r,utm_medium:r,campaign:r,headers:{platform:r,sdk_version:r,browser:r,browser_version:r,region:r,province:r,city:r,language:r,timezone:r,tz_offset:r,screen_height:r,screen_width:r,referrer:r,referrer_host:r,custom:{}}}}},t=screen.width||0,o=screen.height||0,i=t+" x "+o,s=navigator.appVersion,a=navigator.userAgent,c=navigator.language,u=document.referrer,f=function(e){var r=document.createElement("a");return r.href=e,r.hostname}(u),l="",d="",h="",p=""+parseFloat(s),v=void 0,y=void 0;-1!==(v=a.indexOf("Opera"))&&(h="Opera",p=a.substring(v+6),-1!==(v=a.indexOf("Version"))&&(p=a.substring(v+8))),-1!==(v=a.indexOf("Edge"))?(h="Microsoft Edge",p=a.substring(v+5)):-1!==(v=a.indexOf("MSIE"))?(h="Microsoft Internet Explorer",p=a.substring(v+5)):-1!==(v=a.indexOf("Chrome"))?(h="Chrome",p=a.substring(v+7)):-1!==(v=a.indexOf("Safari"))?(h="Safari",p=a.substring(v+7),-1!==(v=a.indexOf("Version"))&&(p=a.substring(v+8))):-1!==(v=a.indexOf("Firefox"))&&(h="Firefox",p=a.substring(v+8)),-1!==(y=p.indexOf(";"))&&(p=p.substring(0,y)),-1!==(y=p.indexOf(" "))&&(p=p.substring(0,y)),-1!==(y=p.indexOf(")"))&&(p=p.substring(0,y));for(var _=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(s)?"wap":"web",g=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],w=0;w<g.length;w++){var b=g[w];if(b.r.test(a)){l=b.s;break}}switch(/Windows/.test(l)&&(d=/Windows (.*)/.exec(l)[1],l="windows"),l){case"Mac OS X":d=/Mac OS X (10[\.\_\d]+)/.exec(a)[1],l="mac";break;case"Android":d=/Android ([\.\_\d]+)/.exec(a)[1],l="android";break;case"iOS":d=(d=/OS (\d+)_(\d+)_?(\d+)?/.exec(s))[1]+"."+d[2]+"."+(0|d[3]),l="ios"}var m={screen_size:i,browser:h,browser_version:p,platform:_,os_name:l,os_version:d,userAgent:a,screen_width:t,screen_height:o,device_model:l,language:c,referrer:u,referrer_host:f};var O=new function e(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),this.get=function(e){var r="";try{var n=localStorage.getItem(e);n&&(r=n=JSON.parse(n))}catch(e){console.error(e.message)}return r},this.set=function(e,r){try{localStorage.setItem(e,r)}catch(e){console.error(e)}}},S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var k="tea-web-sdk: ",E=new function e(){var r=this;!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),this.init=function(e){r.isLog=e},this.info=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];if(r.isLog){var o;(o=console).log.apply(o,[k].concat(n))}},this.warn=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];if(r.isLog){var o;(o=console).warn.apply(o,[k].concat(n))}},this.error=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];if(r.isLog){var o;(o=console).error.apply(o,[k].concat(n))}},this.logJSON=function(e){"object"===(void 0===e?"undefined":S(e))&&r.isLog},this.throw=function(e){throw r.error(k),new Error(e)},this.table=function(e){r.isLog&&console.table(e)}},T=function(e,r,n,t){var o=new XMLHttpRequest;o.open("POST",e,!0),o.setRequestHeader("Content-Type","application/json; charset=utf-8"),o.onload=function(){try{var e=JSON.parse(o.responseText);n&&n(e)}catch(e){console.error(e.message),t&&t()}},o.onerror=function(){t&&t()},o.send(JSON.stringify(r))},q="__tea_cache_";var x=(new Date).getTimezoneOffset(),I=-x/60,j=60*x,R=void 0;try{R="3.1.15"}catch(e){R="2.x"}var N=new(function(e){!function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}(r,e);function r(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r);var n=function(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}(this,e.call(this));return n.initClientEnv=function(){n.set("os_name",m.os_name),n.set("os_version",m.os_version),n.set("device_model",m.device_model),n.set("platform",m.platform),n.set("sdk_version",R),n.set("browser",m.browser),n.set("browser_version",m.browser_version),n.set("language",m.language),n.set("timezone",I),n.set("tz_offset",j),n.set("screen_width",m.screen_width),n.set("screen_height",m.screen_height),n.set("referrer",m.referrer),n.set("referrer_host",m.referrer_host)},n.initClientEnv(),n}return r}(n));var C=new(function(){function e(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.prototype.isString=function(e){return"String"===Object.prototype.toString.call(e).slice(8,-1)},e.prototype.isNumber=function(e){return"Number"===Object.prototype.toString.call(e).slice(8,-1)},e.prototype.isBoolean=function(e){return"Boolean"===Object.prototype.toString.call(e).slice(8,-1)},e.prototype.isFunction=function(e){return"Function"===Object.prototype.toString.call(e).slice(8,-1)},e.prototype.isNull=function(e){return"Null"===Object.prototype.toString.call(e).slice(8,-1)},e.prototype.isUndefined=function(e){return"Undefined"===Object.prototype.toString.call(e).slice(8,-1)},e.prototype.isObj=function(e){return"Object"===Object.prototype.toString.call(e).slice(8,-1)},e.prototype.isArray=function(e){return"Array"===Object.prototype.toString.call(e).slice(8,-1)},e.prototype.isFalse=function(e){return""===e||void 0===e||null===e||"null"===e||"undefined"===e||0===e||!1===e||NaN===e},e.prototype.isTrue=function(e){return!this.isFalse(e)},e.prototype.isLowIE=function(){return window.XDomainRequest},e}()),A=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e};var P={va:"https://vaali-mcs.byteoversea.com",sg:"https://sgali-mcs.byteoversea.com",cn:"https://mcs.snssdk.com",internal:"https://mcs.byted.org"},J=function(e){try{var r=document.cookie.match(new RegExp("(?:^|;)\\s*"+e+"=([^;]+)"));return decodeURIComponent(r?r[1]:"")}catch(e){return""}},L=function(e){!function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}(r,e);function r(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r);var n=function(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}(this,e.call(this));return n.init=function(e,r){if("number"!=typeof e)throw new Error("app_id 必须是一个数字，注意检查是否是以`string`的方式传入的？");n.app_id=e,n.evtDataCacheKey=q+"events_"+e,n.initUrls(r),n.setEnv("app_id",e)},n.initUrls=function(e){if(!P[e])throw new Error("channel 变量只能是`internal`, `cn`, `sg`,`va`");n.reportUrl=P[e]+"/v1/list",n.userTokensPrefix="sg"===e||"va"===e?""+P.sg:""+P[e]},n.setEnv=function(e,r){n.set(e,r),"app_id"===e&&n.checkUserToken(r),"user_unique_id"===e&&n.verifyTokens(r)},n.setEvtParams=function(e){var r=A({},e);Object.keys(r).forEach(function(e){n.evtParams[e]=r[e]})},n.transferFromCookie=function(e){var r=J("tt_webid"),n=J("__tea_sdk__ssid"),t=J("__tea_sdk__user_unique_id");if(C.isLowIE()){if(r){var o={web_id:r,ssid:r,user_unique_id:r};O.set(e,JSON.stringify(o))}return!1}if(r&&n&&t){var i={web_id:r,ssid:n,user_unique_id:t};O.set(e,JSON.stringify(i))}},n.checkUserToken=function(e){var r=q+"tokens_"+e;n.tokensCacheKey=r,n.transferFromCookie(r);var t=O.get(r);return t.user_unique_id&&t.web_id&&t.ssid?(n.envInfo.user.user_unique_id=t.user_unique_id,n.envInfo.user.web_id=t.web_id,n.envInfo.user.ssid=t.ssid,E.warn("初始化已经检测到了 webid ssid user_id，一般情况下不需要再次验证 id 了"),n.unlock(),!1):n.requestWebId(e)},n.requestWebId=function(){n.isRequestWebId=!0;var e=n.userTokensPrefix+"/v1/user/webid";T(e,{app_id:n.app_id,url:location.href,user_agent:m.userAgent,referer:m.referrer,user_unique_id:""},function(e){var r=n.tokensCacheKey;if(0!==e.e)console.error("请求 webid 失败~");else{n.isRequestWebId=!1,n.envInfo.user.ssid=e.ssid,n.envInfo.user.web_id=e.web_id,n.envInfo.user.user_unique_id=e.web_id;var t={web_id:e.web_id,ssid:e.ssid,user_unique_id:e.web_id};O.set(r,JSON.stringify(t)),n.waitForVerifyTokens?(n.lock(),n.verifyTokens(n.realUuid)):(n.unlock(),n.callback&&n.callback())}},function(){n.isRequestWebId=!1,E.error("获取 webid 失败，数据将不会被上报")})},n.verifyTokens=function(e){var r=n.tokensCacheKey;if(n.waitForVerifyTokens=!1,n.realUuid=""+e,n.isRequestWebId)return n.waitForVerifyTokens=!0,console.warn("正在请求 webid，requestSsid 将会在前者请求完毕之后被调用"),!1;var t=O.get(r);if(t.user_unique_id===n.realUuid&&t.ssid&&t.web_id)console.warn("传入的 user_id/user_unique_id 与 缓存中的完全一致，无需再次请求"),n.unlock();else{n.lock(),n.envInfo.user.user_unique_id=n.realUuid;var o=A({},O.get(r),{user_unique_id:n.realUuid});if(O.set(r,JSON.stringify(o)),C.isLowIE())return n.unlock(),!1;n.requestSsid()}},n.requestSsid=function(){var e=n.tokensCacheKey,r=O.get(e),t=n.userTokensPrefix+"/v1/user/ssid";T(t,{app_id:n.app_id,web_id:r.web_id,user_unique_id:""+r.user_unique_id},function(t){if(n.unlock(),0!==t.e)console.error("请求 ssid 失败~");else{n.envInfo.user.ssid=t.ssid;var o=A({},r,{ssid:t.ssid});O.set(e,JSON.stringify(o)),console.warn("根据 user_unique_id 更新 ssid 成功！注意：在这之前不应该有数据被发出去"),n.callback&&n.callback()}},function(){n.unlock(),E.error("根据 user_unique_id 获取新 ssid 失败")})},n.mergeEnvToEvents=function(e){for(var r=[],t=n.evtParams,o=Object.keys(t);e.length;){var i={events:[],user:{},header:{}},s=e.splice(0,5),a=s,c=Array.isArray(a),u=0;for(a=c?a:a[Symbol.iterator]();;){var f;if(c){if(u>=a.length)break;f=a[u++]}else{if((u=a.next()).done)break;f=u.value}var l=f,d=o,h=Array.isArray(d),p=0;for(d=h?d:d[Symbol.iterator]();;){var v;if(h){if(p>=d.length)break;v=d[p++]}else{if((p=d.next()).done)break;v=p.value}var y=v;void 0===l.params[y]&&(l.params[y]=t[y])}var _=JSON.stringify(l.params);l.params=_}i.events=s,i.events=s;var g=n.mergeEnv();i.user=g.user,i.header=g.header,r.push(i)}return r},n.mergeEnv=function(){var e=n.get(),r=N.get(),t=A({},e.user),o=A({},r.header.headers.custom,e.header.headers.custom),i=A({},r.header.headers,e.header.headers,{custom:o}),s=A({},r.header,e.header);return{user:t,header:A({},s,{headers:JSON.stringify(i)})}},n.evtParams={},n}return r.prototype.lock=function(){this.isUserTokensReady=!1},r.prototype.unlock=function(){this.isUserTokensReady=!0},r}(n);var U=new function e(){var r=this;!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),this.set=function(e,n){r.cache[e]=n},this.get=function(e){var n=[],t=r.cache[e];if(t){var o=t,i=Array.isArray(o),s=0;for(o=i?o:o[Symbol.iterator]();;){var a;if(i){if(s>=o.length)break;a=o[s++]}else{if((s=o.next()).done)break;a=s.value}var c=a;n.push(c)}}else n=[];return n},this.clean=function(e){r.cache[e]=void 0},this.cache={}},W=function(e,r){try{var n=e.split("v1")[0];r.forEach(function(e){var r=function(e){var r="";for(var n in e)e.hasOwnProperty(n)&&(r+="&"+n+"="+encodeURIComponent(JSON.stringify(e[n])));return r="&"===r[0]?r.slice(1):r}(e),t=new Image(1,1);t.onload=function(){t=null},t.onerror=function(){t=null},t.src=n+"/v1/gif?"+r})}catch(e){console.error(e.message)}},M=function(e,r){if(window.XDomainRequest)return W(e,r);var n=new XMLHttpRequest;n.open("POST",e+"?rdn="+Math.random(),!0),n.onload=function(){try{JSON.parse(n.responseText)}catch(e){E.error(e.message)}},n.onerror=function(){n.abort()},n.send(JSON.stringify(r))},D=!1,F=function(e,r,n,t){try{var o=e.split("v1")[0];o||console.error("Reported url is wrong"),r.forEach(function(e){var r=function(e){var r="";for(var n in e)e.hasOwnProperty(n)&&(r+="&"+n+"="+encodeURIComponent(JSON.stringify(e[n])));return r="&"===r[0]?r.slice(1):r}(e),i=new Image(1,1);i.onload=function(){i=null,n()},i.onerror=function(){i=null,t()},i.src=o+"/v1/gif?"+r})}catch(e){console.error(e.message)}},X=function(e,r,n,t,o){if(!D){D=!0;try{var i=r[0].header,s=r[0].user;K(e,{app_id:i.app_id,app_name:i.app_name,sdk_version:JSON.parse(i.headers).sdk_version,web_id:s.web_id})}catch(e){console.error("hasOnloadReport",e.message)}}var a=r;if(window.XDomainRequest)return F(e,a,n,t);if(o)return window.navigator&&window.navigator.sendBeacon?window.navigator.sendBeacon(e,JSON.stringify(a)):F(e,a,n,t);var c=new XMLHttpRequest;c.open("POST",e+"?rdn="+Math.random(),!0),c.onload=function(){try{var r=JSON.parse(c.responseText);0!==r.e?(z(e,a,r.e),-2===r.e&&E.warn("The field is in the wrong format. It is most likely written as an int string"),E.error("数据上报失败！","错误码："+r.e),E.error("为了避免后续上报数据被阻塞，sdk 将不再重试上报本数据，数据实体将会从 localstorage 清除")):E.warn("数据上报成功: ",a),n()}catch(r){E.error(r.message),t(),z(e,a,500)}},c.onerror=function(){c.abort(),E.error("数据上报失败"),t(),z(e,a,500)},c.send(JSON.stringify(a))},K=function(e,r){try{var n={events:[{event:"onload",params:JSON.stringify({app_id:r.app_id,app_name:r.app_name||"",sdk_version:r.sdk_version}),local_time_ms:Date.now()}],user:{user_unique_id:r.web_id},header:{app_id:1338}};setTimeout(function(){M(e,[n])},16)}catch(e){console.error("postOnloadLog: ",e.message)}},z=function(e,r,n){try{var t=r[0].user,o=r[0].header,i=[];r.forEach(function(e){e.events.forEach(function(e){i.push(e)})});var s={events:i.map(function(e){return{event:"on_error",params:JSON.stringify({error_code:n,app_id:o.app_id,app_name:o.app_name||"",error_event:e.event,local_time_ms:e.local_time_ms,tea_event_index:Date.now(),params:e.params,header:JSON.stringify(o)}),local_time_ms:Date.now()}}),user:{user_unique_id:t.web_id},header:{app_id:1338}};setTimeout(function(){M(e,[s])},16)}catch(e){console.error("postErrLog: ",e.message)}};var V=function(e){!function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}(r,e);function r(n){var t=n.app_id,o=n.channel;!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r);var i=function(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}(this,e.call(this));return i.addListener=function(){window.addEventListener("unload",function(){i.forceReport=!0,i.report()},!1),window.addEventListener("beforeunload",function(){i.forceReport=!0,i.report()},!1)},i.setReady=function(e){i.isReady=e,i.report()},i.event=function(e){var r=i.evtDataCacheKey,n=U.get(r)||[];n.push(e),U.set(r,n),n.length>=5?i.report():setTimeout(function(){i.report()},45)},i.report=function(){if(!i.isUserTokensReady)return!1;var e=i.evtDataCacheKey,r=U.get(e);U.clean(e);var n=i.mergeEnvToEvents(r),t=O.get(e)||[],o=n.concat(t);if(!o.length)return E.info("内存缓存，以及 localStorage 中的剩余数据均已上报完毕，等待下次事件触发！"),E.info(""),!1;if(O.set(e,JSON.stringify(o)),!i.isReady)return!1;if(i.isReporting)return!1;E.info("localStorage 中固化的数据，即将被分解上报！"),E.info(o);var s=0,a=null,c=i.sliceLength,u=o.length;u<=c?(s=u,a=o):(s=c,E.info("上述固化数据中的"+c+"条被成功上报！"),E.info(""),a=o.slice(u-c)),i.sendData(a,s)},i.sendData=function(e,r){i.isReporting=!0,X(i.reportUrl,e,function(){i.sendDataSuccess(r)},function(){i.isReporting=!1,setTimeout(function(){i.report()},3e3)},i.forceReport)},i.sendDataSuccess=function(e){var r=i.evtDataCacheKey;i.isReporting=!1;var n=O.get(r),t=n.length,o=n.slice(0,t-e);O.set(r,JSON.stringify(o)),i.report()},i.sliceLength=5,i.init(t,o),i.isReady=!1,i.forceReport=!1,i.addListener(),i}return r}(L),B=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e};var H=/^event\./,G=window.TeaAnalyticsObject;G||(G="collectEvent",window.TeaAnalyticsObject=G);var Q=window[G];Q||((Q=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return Q.q.push(r),Q}).q=Q.q||[],window[G]=Q);return new function e(){var r=this;return function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),this.processCache=function(){if(r.cachaCalled)return!1;!function(){var e=[].concat(Q.q),n=function(e){if(C.isFunction(r[e[0]])){var n=e[0],t=r[n],o=e.slice(1);t.apply(r,o)}else{var i=e[0];H.test(i)&&(i=i.slice(6));var s=e[1];r.event(i,s)}};if(Q.q.push=function(e){var r=e;return r=Array.prototype.slice.call(r),n(r),Q},!e.length)return!1;r.channel&&(r.cachaCalled=!0,e.forEach(function(e){var r=e;r=Array.prototype.slice.call(r),n(r)}));var t=0;e.some(function(e,r){if("init"===e[0])return t=r,!0})&&(r.cachaCalled=!0,0===t?e.forEach(function(e){var r=e;r=Array.prototype.slice.call(r),n(r)}):e.splice(t,1).concat(e).forEach(function(e){var r=e;r=Array.prototype.slice.call(r),n(r)}))}()},this.init=function(e){if(!C.isObj(e))throw new Error("init 的参数必须是{app_id, channel}");r.channel=new V(e),r.channel.callback=function(){r.callbackSend&&r.start()}},this.config=function(e){C.isObj(e)||E.throw("config 参数必须是 {} 的格式"),e.log&&(E.init(!0),e.log=null);var n=Object.keys(e);if(!n.length)return!1;var t=n,o=Array.isArray(t),i=0;for(t=o?t:t[Symbol.iterator]();;){var s;if(o){if(i>=t.length)break;s=t[i++]}else{if((i=t.next()).done)break;s=i.value}var a=s,c=e[a];"evtParams"===a?r.channel.setEvtParams(c):"_staging_flag"===a?(""+c=="1"&&E.warn("根据_staging_flag设置，数据将会上报到stag 表。"),r.channel.setEvtParams({_staging_flag:c})):r.channel.setEnv(a,c)}},this.send=function(){r.channel.isUserTokensReady?(E.warn("看到本提示，意味着用户信息已完全就绪，上报通道打开"),E.info("用户信息",JSON.stringify(r.channel.get().user,null,2)),r.channel.setReady(!0),r.processCache(),r.pv()):r.callbackSend=!0},this.start=function(){r.channel.isUserTokensReady?(E.warn("看到本提示，意味着用户信息已完全就绪，上报通道打开"),E.info("用户信息",JSON.stringify(r.channel.get().user,null,2)),r.channel.setReady(!0),r.processCache(),r.pv()):r.callbackSend=!0},this.pv=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n={title:document.title||location.pathname,url:location.href,url_path:location.pathname},t=B({},n,e);r.event("predefine_pageview",t)},this.count=function(){var e=Date.now();return++e},this.event=function(e,n){var t=n;C.isObj(t)||(t={}),t.event_index=r.count();var o={event:e,params:t,local_time_ms:+new Date};r.channel.event(o)},this.cachaCalled=!1,this.processCache(),Q.init=this.init,Q.config=this.config,Q.send=this.send,Q.start=this.start,Q}}();
